# üõ†Ô∏è GU√çA DE IMPLEMENTACI√ìN DETALLADA
## Para Asistente IA (Gemini/Claude) - Tareas Prioritarias INVCORE

**Fecha:** 3 de Febrero 2026  
**Versi√≥n:** 1.0  
**Objetivo:** Documento paso a paso para implementar las 3 mejoras prioritarias sin errores.

---

## üìã √çNDICE

1. [Contexto del Proyecto](#1-contexto-del-proyecto)
2. [Tarea 1: Maestro-Detalle para Inventario](#2-tarea-1-maestro-detalle-inventario)
3. [Tarea 2: Importaci√≥n Excel con Preview](#3-tarea-2-importacion-excel-mejorada)
4. [Tarea 3: Backlog Centralizado de OTs](#4-tarea-3-backlog-centralizado-ots)
5. [Comandos de Verificaci√≥n](#5-comandos-verificacion)

---

## 1. CONTEXTO DEL PROYECTO

### Stack Tecnol√≥gico
- **Frontend:** React 18 + TypeScript + Vite
- **Backend:** NestJS + TypeScript  
- **Base de Datos:** Microsoft SQL Server
- **Estilos:** CSS Vanilla (Dark Theme)

### Rutas de Archivos Importantes

```
d:\inventario\
‚îú‚îÄ‚îÄ frontend\
‚îÇ   ‚îú‚îÄ‚îÄ src\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules\
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventario\
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InventarioView.tsx      # Vista principal inventario
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ operaciones\
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ OperacionesView.tsx     # Vista OTs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services\
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.service.ts              # Servicios API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components\
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Modal.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DataTable.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ SidePanel.tsx
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ backend\
‚îÇ   ‚îú‚îÄ‚îÄ src\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inv_modules\
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventario\
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventario.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inventario.repo.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ operaciones\
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ operaciones.controller.ts
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ operaciones.repo.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db\
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ base.repo.ts                # Funciones SQL base
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ docs\
```

### Patrones de C√≥digo Existentes

**Frontend - Llamada API:**
```typescript
import { invService } from '../../services/api.service';
const res = await invService.getStock();
const data = res.data.data || res.data || [];
```

**Frontend - Estado React:**
```typescript
const [items, setItems] = useState<any[]>([]);
const [loading, setLoading] = useState(false);
```

**Backend - Endpoint Controller:**
```typescript
@Post('ruta')
@Roles('ADMIN', 'SUPERVISOR')
async metodo(@Body() dto: any, @Request() req: any) {
    return await repo.funcion({ ...dto, idUsuario: req.user.userId });
}
```

**Backend - Repositorio SQL:**
```typescript
import { Int, NVarChar, ejecutarQuery } from '../../db/base.repo';
export async function miFuncion(dto: any) {
    return await ejecutarQuery(`SELECT * FROM tabla WHERE id = @id`, {
        id: { valor: dto.id, tipo: Int }
    });
}
```

---

## 2. TAREA 1: MAESTRO-DETALLE INVENTARIO

### Problema Actual
El modal de entrada de inventario (`showEntryModal` en `InventarioView.tsx`) solo permite agregar **1 producto a la vez**. Los usuarios deben abrir el modal m√∫ltiples veces para ingresar una factura completa.

### Soluci√≥n
Crear interfaz "Factura de Proveedor" con grid editable para agregar N productos antes de guardar.

### Archivos a Modificar

#### 2.1 Frontend: `d:\inventario\frontend\src\modules\inventario\InventarioView.tsx`

**PASO 1:** Agregar nuevo estado para lista de items (l√≠nea ~50)

```typescript
// AGREGAR despu√©s de l√≠nea 50:
const [entryItems, setEntryItems] = useState<{
    productoId: string;
    productoNombre: string;
    cantidad: number;
    costoUnitario: number;
}[]>([]);
```

**PASO 2:** Crear funci√≥n para agregar item a la lista

```typescript
// AGREGAR despu√©s de handleRegisterEntry (l√≠nea ~143):
const handleAddItemToList = () => {
    if (!entryForm.productoId || entryForm.cantidad <= 0) {
        return alertError('Seleccione producto y cantidad v√°lida');
    }
    
    const producto = productos.find(p => p.idProducto.toString() === entryForm.productoId);
    if (!producto) return;
    
    setEntryItems(prev => [...prev, {
        productoId: entryForm.productoId,
        productoNombre: `${producto.codigo} - ${producto.nombre}`,
        cantidad: entryForm.cantidad,
        costoUnitario: entryForm.costoUnitario
    }]);
    
    // Limpiar campos para siguiente producto
    setEntryForm(prev => ({ ...prev, productoId: '', cantidad: 1, costoUnitario: 0 }));
    setProductSearchTerm('');
};

const handleRemoveItem = (index: number) => {
    setEntryItems(prev => prev.filter((_, i) => i !== index));
};

const handleSaveAllItems = async () => {
    if (entryItems.length === 0) return alertError('Agregue al menos un producto');
    if (entryType === 'PROVEEDOR' && !entryForm.proveedorId) return alertError('Seleccione proveedor');
    
    setProcessing(true);
    try {
        await invService.registrarMovimiento({
            tipoMovimiento: 'ENTRADA',
            almacenDestinoId: parseInt(entryForm.almacenId),
            notas: entryForm.notas || 'Ingreso m√∫ltiple',
            detalles: entryItems.map(item => ({
                productoId: parseInt(item.productoId),
                cantidad: item.cantidad,
                propietarioTipo: entryType,
                proveedorId: entryType === 'PROVEEDOR' ? parseInt(entryForm.proveedorId) : 0,
                costoUnitario: item.costoUnitario
            }))
        });
        alertSuccess(`${entryItems.length} productos ingresados correctamente`);
        setShowEntryModal(false);
        setEntryItems([]);
        fetchStock(selectedAlmacen);
    } catch (err) {
        alertError('Error al registrar entrada');
    } finally {
        setProcessing(false);
    }
};
```

**PASO 3:** Modificar Modal de Entrada (reemplazar contenido del Modal ~l√≠nea 411-553)

Buscar el `<Modal>` con t√≠tulo "Registrar Entrada de Mercanc√≠a" y modificar su contenido para incluir:

1. √Årea superior para selector de producto (existente)
2. Bot√≥n "Agregar a Lista" en lugar del bot√≥n "Registrar"
3. Tabla/Grid mostrando items agregados con bot√≥n eliminar
4. Resumen de total de items y valor
5. Bot√≥n final "Guardar Todo"

**C√≥digo del Grid de Items (agregar antes del bot√≥n final):**

```tsx
{/* Lista de Items Agregados */}
{entryItems.length > 0 && (
    <div style={{ marginTop: '20px', border: '1px solid var(--border)', borderRadius: '8px', overflow: 'hidden' }}>
        <div style={{ background: '#1a1a1a', padding: '10px 15px', fontWeight: 600, fontSize: '0.85rem' }}>
            üì¶ Productos a Ingresar ({entryItems.length})
        </div>
        <div style={{ maxHeight: '200px', overflowY: 'auto' }}>
            {entryItems.map((item, idx) => (
                <div key={idx} style={{ 
                    display: 'flex', 
                    justifyContent: 'space-between', 
                    alignItems: 'center',
                    padding: '10px 15px',
                    borderBottom: '1px solid rgba(255,255,255,0.05)'
                }}>
                    <div>
                        <div style={{ fontWeight: 600 }}>{item.productoNombre}</div>
                        <div style={{ fontSize: '0.8rem', color: '#94a3b8' }}>
                            Cant: {item.cantidad} | ${item.costoUnitario.toFixed(2)} c/u
                        </div>
                    </div>
                    <button 
                        className="btn-danger" 
                        style={{ padding: '4px 8px', fontSize: '0.75rem' }}
                        onClick={() => handleRemoveItem(idx)}
                    >
                        ‚úï
                    </button>
                </div>
            ))}
        </div>
        <div style={{ background: '#1a1a1a', padding: '10px 15px', display: 'flex', justifyContent: 'space-between' }}>
            <span>Total Items: <b>{entryItems.length}</b></span>
            <span>Valor Total: <b style={{ color: 'var(--primary)' }}>
                ${entryItems.reduce((sum, i) => sum + (i.cantidad * i.costoUnitario), 0).toFixed(2)}
            </b></span>
        </div>
    </div>
)}
```

**PASO 4:** Modificar botones del modal

```tsx
<div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '15px' }}>
    <button className="btn-secondary" onClick={() => handleAddItemToList()} disabled={processing}>
        + Agregar a Lista
    </button>
    <button className="btn-secondary" onClick={() => { setShowEntryModal(false); setEntryItems([]); }} disabled={processing}>
        Cancelar
    </button>
    <button 
        className="btn-primary" 
        onClick={handleSaveAllItems} 
        disabled={processing || entryItems.length === 0}
    >
        {processing ? 'Guardando...' : `Guardar ${entryItems.length} Items`}
    </button>
</div>
```

---

## 3. TAREA 2: IMPORTACI√ìN EXCEL MEJORADA

### Problema Actual
El importador Excel es "todo o nada". Si una fila tiene error, falla silenciosamente.

### Soluci√≥n
Mostrar preview antes de importar, resaltar errores, permitir excluir filas.

### Archivos a Modificar

#### 3.1 Frontend: `d:\inventario\frontend\src\modules\inventario\InventarioView.tsx`

**PASO 1:** Agregar estados para preview (~l√≠nea 38)

```typescript
// AGREGAR:
const [previewData, setPreviewData] = useState<any[]>([]);
const [showPreview, setShowPreview] = useState(false);
```

**PASO 2:** Instalar librer√≠a xlsx (ejecutar en terminal)

```bash
cd d:\inventario\frontend
npm install xlsx
```

**PASO 3:** Importar xlsx al inicio del archivo

```typescript
import * as XLSX from 'xlsx';
```

**PASO 4:** Modificar handleFileChange para parsear Excel localmente

```typescript
const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files || e.target.files.length === 0) return;
    const file = e.target.files[0];
    setImportFile(file);
    
    // Parsear Excel para preview
    const reader = new FileReader();
    reader.onload = (evt) => {
        const data = evt.target?.result;
        const workbook = XLSX.read(data, { type: 'binary' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(sheet);
        
        // Validar cada fila
        const validated = jsonData.map((row: any, idx: number) => {
            const errors: string[] = [];
            const codigo = row.Codigo || row.codigo || row.CODIGO || '';
            const cantidad = parseFloat(row.Cantidad || row.cantidad || row.CANTIDAD || 0);
            
            if (!codigo) errors.push('C√≥digo vac√≠o');
            if (isNaN(cantidad) || cantidad <= 0) errors.push('Cantidad inv√°lida');
            
            // Verificar si producto existe
            const producto = productos.find(p => p.codigo === codigo);
            if (!producto && codigo) errors.push('Producto no encontrado');
            
            return {
                fila: idx + 2, // +2 por header y base-1
                codigo,
                cantidad,
                productoNombre: producto?.nombre || '???',
                errors,
                incluir: errors.length === 0
            };
        });
        
        setPreviewData(validated);
        setShowPreview(true);
    };
    reader.readAsBinaryString(file);
};
```

**PASO 5:** Agregar Modal de Preview (despu√©s del Modal de Importaci√≥n existente)

```tsx
{/* Modal Preview Excel */}
<Modal
    isOpen={showPreview}
    onClose={() => setShowPreview(false)}
    title="Vista Previa de Importaci√≥n"
    width="800px"
>
    <div style={{ marginBottom: '15px', display: 'flex', justifyContent: 'space-between' }}>
        <span>Total filas: <b>{previewData.length}</b></span>
        <span style={{ color: '#10b981' }}>
            V√°lidas: <b>{previewData.filter(r => r.errors.length === 0).length}</b>
        </span>
        <span style={{ color: '#ef4444' }}>
            Con errores: <b>{previewData.filter(r => r.errors.length > 0).length}</b>
        </span>
    </div>
    
    <div style={{ maxHeight: '400px', overflowY: 'auto', border: '1px solid var(--border)', borderRadius: '8px' }}>
        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '0.85rem' }}>
            <thead>
                <tr style={{ background: '#1a1a1a', position: 'sticky', top: 0 }}>
                    <th style={{ padding: '10px', textAlign: 'left' }}>Incluir</th>
                    <th style={{ padding: '10px', textAlign: 'left' }}>Fila</th>
                    <th style={{ padding: '10px', textAlign: 'left' }}>C√≥digo</th>
                    <th style={{ padding: '10px', textAlign: 'left' }}>Producto</th>
                    <th style={{ padding: '10px', textAlign: 'right' }}>Cantidad</th>
                    <th style={{ padding: '10px', textAlign: 'left' }}>Estado</th>
                </tr>
            </thead>
            <tbody>
                {previewData.map((row, idx) => (
                    <tr key={idx} style={{ 
                        background: row.errors.length > 0 ? 'rgba(239, 68, 68, 0.1)' : 'transparent',
                        borderBottom: '1px solid rgba(255,255,255,0.05)'
                    }}>
                        <td style={{ padding: '8px 10px' }}>
                            <input 
                                type="checkbox" 
                                checked={row.incluir} 
                                onChange={() => {
                                    const updated = [...previewData];
                                    updated[idx].incluir = !updated[idx].incluir;
                                    setPreviewData(updated);
                                }}
                                disabled={row.errors.length > 0}
                            />
                        </td>
                        <td style={{ padding: '8px 10px' }}>{row.fila}</td>
                        <td style={{ padding: '8px 10px' }}><code>{row.codigo}</code></td>
                        <td style={{ padding: '8px 10px' }}>{row.productoNombre}</td>
                        <td style={{ padding: '8px 10px', textAlign: 'right' }}>{row.cantidad}</td>
                        <td style={{ padding: '8px 10px' }}>
                            {row.errors.length === 0 ? (
                                <span style={{ color: '#10b981' }}>‚úì OK</span>
                            ) : (
                                <span style={{ color: '#ef4444', fontSize: '0.75rem' }}>
                                    {row.errors.join(', ')}
                                </span>
                            )}
                        </td>
                    </tr>
                ))}
            </tbody>
        </table>
    </div>
    
    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '20px' }}>
        <button className="btn-secondary" onClick={() => setShowPreview(false)}>Cancelar</button>
        <button 
            className="btn-primary" 
            onClick={async () => {
                const itemsToImport = previewData.filter(r => r.incluir && r.errors.length === 0);
                if (itemsToImport.length === 0) return alertError('No hay items v√°lidos');
                
                setUploading(true);
                try {
                    // Enviar solo items v√°lidos
                    await invService.registrarMovimiento({
                        tipoMovimiento: 'ENTRADA_CARGA_MASIVA',
                        almacenDestinoId: parseInt(targetAlmacen),
                        notas: 'Importaci√≥n Excel con validaci√≥n',
                        detalles: itemsToImport.map(item => {
                            const prod = productos.find(p => p.codigo === item.codigo);
                            return {
                                productoId: prod?.idProducto,
                                cantidad: item.cantidad,
                                propietarioTipo: 'EMPRESA',
                                proveedorId: 0,
                                costoUnitario: 0
                            };
                        })
                    });
                    alertSuccess(`${itemsToImport.length} productos importados`);
                    setShowPreview(false);
                    setShowImportModal(false);
                    setPreviewData([]);
                    fetchStock();
                } catch (err) {
                    alertError('Error en importaci√≥n');
                } finally {
                    setUploading(false);
                }
            }}
            disabled={uploading || previewData.filter(r => r.incluir).length === 0}
        >
            {uploading ? 'Importando...' : `Importar ${previewData.filter(r => r.incluir).length} Items`}
        </button>
    </div>
</Modal>
```

---

## 4. TAREA 3: BACKLOG CENTRALIZADO OTS

### Problema Actual
No existe vista consolidada de √≥rdenes pendientes/sin asignar.

### Soluci√≥n
Crear vista "Backlog" con filtros y asignaci√≥n r√°pida.

### Archivos a Crear/Modificar

#### 4.1 Crear nuevo archivo: `d:\inventario\frontend\src\modules\operaciones\BacklogView.tsx`

```tsx
import { useState, useEffect } from 'react';
import { opeService, authService } from '../../services/api.service';
import { alertSuccess, alertError } from '../../services/alert.service';
import { DataTable } from '../../components/DataTable';
import { Modal } from '../../components/Modal';
import { UserPlus, Filter, RefreshCw } from 'lucide-react';

export const BacklogView = () => {
    const [ots, setOts] = useState<any[]>([]);
    const [tecnicos, setTecnicos] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [filters, setFilters] = useState({
        estado: 'PENDIENTE',
        prioridad: '',
        sinAsignar: true
    });
    
    // Modal asignaci√≥n
    const [showAssignModal, setShowAssignModal] = useState(false);
    const [selectedOT, setSelectedOT] = useState<any>(null);
    const [selectedTecnico, setSelectedTecnico] = useState('');
    
    useEffect(() => {
        loadData();
    }, [filters]);
    
    const loadData = async () => {
        setLoading(true);
        try {
            const [otsRes, usersRes] = await Promise.all([
                opeService.listarOTs(filters),
                authService.getUsers()
            ]);
            
            let otsData = otsRes.data?.data || otsRes.data || [];
            let usersData = usersRes.data?.data || usersRes.data || [];
            
            // Filtrar solo t√©cnicos
            const tecnicosList = usersData.filter((u: any) => 
                u.rolNombre?.toUpperCase().includes('TECNICO')
            );
            
            // Aplicar filtro de sin asignar
            if (filters.sinAsignar) {
                otsData = otsData.filter((ot: any) => !ot.idTecnicoAsignado);
            }
            
            setOts(otsData);
            setTecnicos(tecnicosList);
        } catch (err) {
            console.error(err);
        } finally {
            setLoading(false);
        }
    };
    
    const handleAssign = async () => {
        if (!selectedOT || !selectedTecnico) return;
        try {
            await opeService.asignarOT(selectedOT.idOT, parseInt(selectedTecnico));
            alertSuccess(`OT #${selectedOT.idOT} asignada correctamente`);
            setShowAssignModal(false);
            setSelectedOT(null);
            setSelectedTecnico('');
            loadData();
        } catch (err) {
            alertError('Error al asignar');
        }
    };
    
    const columns = [
        {
            key: 'idOT',
            label: 'OT #',
            render: (val: number) => <span style={{ fontWeight: 800, color: 'var(--primary)' }}>#{val}</span>
        },
        {
            key: 'prioridad',
            label: 'Prioridad',
            render: (val: string) => {
                const colors: any = {
                    'CRITICA': { bg: '#7f1d1d', text: '#fca5a5' },
                    'ALTA': { bg: '#991b1b', text: '#fca5a5' },
                    'MEDIA': { bg: '#92400e', text: '#fcd34d' },
                    'BAJA': { bg: '#1e3a5f', text: '#93c5fd' }
                };
                const style = colors[val] || colors['MEDIA'];
                return <span style={{ 
                    background: style.bg, 
                    color: style.text, 
                    padding: '4px 10px', 
                    borderRadius: '6px',
                    fontSize: '0.75rem',
                    fontWeight: 700
                }}>{val}</span>;
            }
        },
        { key: 'clienteNombre', label: 'Cliente' },
        { key: 'clienteDireccion', label: 'Direcci√≥n' },
        { 
            key: 'fechaCreacion', 
            label: 'Creada',
            render: (val: string) => new Date(val).toLocaleDateString()
        },
        {
            key: 'tecnicoNombre',
            label: 'Asignado',
            render: (val: string) => val || <span style={{ color: '#ef4444' }}>Sin Asignar</span>
        },
        {
            key: 'acciones',
            label: 'Acci√≥n',
            render: (_: any, row: any) => (
                <button 
                    className="btn-primary"
                    style={{ padding: '6px 12px', fontSize: '0.75rem', display: 'flex', alignItems: 'center', gap: '5px' }}
                    onClick={() => { setSelectedOT(row); setShowAssignModal(true); }}
                >
                    <UserPlus size={14} /> Asignar
                </button>
            )
        }
    ];
    
    return (
        <div style={{ animation: 'fadeIn 0.3s' }}>
            <header style={{ marginBottom: '30px' }}>
                <h1 style={{ fontSize: '2rem', fontWeight: 900, marginBottom: '5px' }}>
                    üìã Backlog de √ìrdenes de Trabajo
                </h1>
                <p style={{ color: 'var(--text-muted)' }}>
                    Gesti√≥n centralizada de OTs pendientes y asignaci√≥n a t√©cnicos.
                </p>
            </header>
            
            {/* Filtros */}
            <div className="card" style={{ marginBottom: '20px', padding: '15px' }}>
                <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap', alignItems: 'center' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <Filter size={16} />
                        <span style={{ fontWeight: 600 }}>Filtros:</span>
                    </div>
                    
                    <select 
                        className="form-input" 
                        style={{ width: 'auto' }}
                        value={filters.estado}
                        onChange={e => setFilters({...filters, estado: e.target.value})}
                    >
                        <option value="">Todos los Estados</option>
                        <option value="PENDIENTE">Pendiente</option>
                        <option value="EN_PROGRESO">En Progreso</option>
                        <option value="FINALIZADA">Finalizada</option>
                    </select>
                    
                    <select 
                        className="form-input" 
                        style={{ width: 'auto' }}
                        value={filters.prioridad}
                        onChange={e => setFilters({...filters, prioridad: e.target.value})}
                    >
                        <option value="">Todas las Prioridades</option>
                        <option value="CRITICA">Cr√≠tica</option>
                        <option value="ALTA">Alta</option>
                        <option value="MEDIA">Media</option>
                        <option value="BAJA">Baja</option>
                    </select>
                    
                    <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                        <input 
                            type="checkbox" 
                            checked={filters.sinAsignar}
                            onChange={e => setFilters({...filters, sinAsignar: e.target.checked})}
                        />
                        Solo Sin Asignar
                    </label>
                    
                    <button className="btn-secondary" onClick={loadData} style={{ marginLeft: 'auto' }}>
                        <RefreshCw size={16} /> Actualizar
                    </button>
                </div>
            </div>
            
            {/* M√©tricas R√°pidas */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '15px', marginBottom: '20px' }}>
                <div className="card" style={{ padding: '15px', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 800, color: '#ef4444' }}>
                        {ots.filter(o => o.prioridad === 'CRITICA' || o.prioridad === 'ALTA').length}
                    </div>
                    <div style={{ fontSize: '0.75rem', color: '#94a3b8', textTransform: 'uppercase' }}>Urgentes</div>
                </div>
                <div className="card" style={{ padding: '15px', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 800, color: '#f59e0b' }}>
                        {ots.filter(o => !o.idTecnicoAsignado).length}
                    </div>
                    <div style={{ fontSize: '0.75rem', color: '#94a3b8', textTransform: 'uppercase' }}>Sin Asignar</div>
                </div>
                <div className="card" style={{ padding: '15px', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 800, color: '#3b82f6' }}>
                        {ots.filter(o => o.estado === 'EN_PROGRESO').length}
                    </div>
                    <div style={{ fontSize: '0.75rem', color: '#94a3b8', textTransform: 'uppercase' }}>En Curso</div>
                </div>
                <div className="card" style={{ padding: '15px', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 800 }}>{ots.length}</div>
                    <div style={{ fontSize: '0.75rem', color: '#94a3b8', textTransform: 'uppercase' }}>Total Backlog</div>
                </div>
            </div>
            
            <DataTable
                columns={columns}
                data={ots}
                loading={loading}
                title=""
            />
            
            {/* Modal Asignaci√≥n */}
            <Modal
                isOpen={showAssignModal}
                onClose={() => setShowAssignModal(false)}
                title={`Asignar OT #${selectedOT?.idOT}`}
                width="500px"
            >
                {selectedOT && (
                    <div>
                        <div style={{ background: '#1a1a1a', padding: '15px', borderRadius: '8px', marginBottom: '20px' }}>
                            <div style={{ fontWeight: 700, marginBottom: '5px' }}>{selectedOT.clienteNombre}</div>
                            <div style={{ fontSize: '0.85rem', color: '#94a3b8' }}>{selectedOT.clienteDireccion}</div>
                            <div style={{ fontSize: '0.85rem', color: '#94a3b8', marginTop: '5px' }}>
                                {selectedOT.descripcionTrabajo}
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Seleccionar T√©cnico</label>
                            <select 
                                className="form-input"
                                value={selectedTecnico}
                                onChange={e => setSelectedTecnico(e.target.value)}
                            >
                                <option value="">-- Seleccionar --</option>
                                {tecnicos.map(t => (
                                    <option key={t.idUsuario} value={t.idUsuario}>{t.nombre}</option>
                                ))}
                            </select>
                        </div>
                        
                        <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '20px' }}>
                            <button className="btn-secondary" onClick={() => setShowAssignModal(false)}>Cancelar</button>
                            <button className="btn-primary" onClick={handleAssign} disabled={!selectedTecnico}>
                                Asignar T√©cnico
                            </button>
                        </div>
                    </div>
                )}
            </Modal>
        </div>
    );
};
```

#### 4.2 Agregar Ruta: `d:\inventario\frontend\src\App.tsx`

Buscar las rutas existentes y agregar:

```tsx
import { BacklogView } from './modules/operaciones/BacklogView';

// En el Router, agregar:
<Route path="/backlog" element={<BacklogView />} />
```

#### 4.3 Agregar al Men√∫: `d:\inventario\frontend\src\components\Sidebar.tsx`

Buscar el array de men√∫ y agregar entrada:

```tsx
{ path: '/backlog', label: 'Backlog OTs', icon: ClipboardList, roles: ['ADMIN', 'SUPERVISOR'] },
```

---

## 5. COMANDOS DE VERIFICACI√ìN

### Despu√©s de cada tarea, ejecutar:

```bash
# Terminal 1 - Frontend
cd d:\inventario\frontend
npm run build

# Si hay errores, revisarlos y corregir
# Si compila OK, probar en desarrollo:
npm run dev
```

```bash
# Terminal 2 - Backend (si se modific√≥)
cd d:\inventario\backend
npm run build
npm run start:dev
```

### Pruebas Manuales

1. **Maestro-Detalle:**
   - Ir a Inventario > Bot√≥n "Entrada"
   - Agregar 3 productos diferentes
   - Verificar que aparecen en la lista
   - Guardar y verificar en stock

2. **Excel Preview:**
   - Ir a Inventario > Bot√≥n "Excel"
   - Subir archivo con errores intencionales
   - Verificar que se muestran en rojo
   - Desmarcar filas malas e importar

3. **Backlog:**
   - Ir a /backlog
   - Verificar filtros funcionan
   - Asignar OT a t√©cnico
   - Verificar que desaparece de "Sin Asignar"

---

## üìå NOTAS IMPORTANTES

1. **NO modificar `base.repo.ts`** - Es cr√≠tico para la conexi√≥n SQL
2. **Siempre usar `res.data.data || res.data`** - El backend puede envolver respuestas
3. **Verificar imports** - Cada archivo nuevo necesita sus imports correctos
4. **Mantener estilos inline** - El proyecto usa CSS inline, no clases Tailwind
5. **Commit despu√©s de cada tarea** - `git add . && git commit -m "feat: descripci√≥n"`

---

*Documento creado: 3 de Febrero 2026*
*Para uso de asistente IA en implementaci√≥n*
