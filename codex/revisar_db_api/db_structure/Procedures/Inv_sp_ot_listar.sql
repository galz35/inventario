CREATE PROCEDURE Inv_sp_ot_listar @idProyecto INT = NULL, @idTecnico INT = NULL, @estado NVARCHAR(50) = NULL, @buscar NVARCHAR(100) = NULL AS BEGIN SET NOCOUNT ON; SELECT ot.*, p.nombre AS proyectoNombre, c.nombre AS clienteNombre, u.nombre AS tecnicoNombre, t.nombre AS tipoNombre FROM Inv_ope_ot ot LEFT JOIN Inv_ope_proyectos p ON ot.idProyecto = p.idProyecto LEFT JOIN Inv_cat_clientes c ON ot.idCliente = c.idCliente LEFT JOIN Inv_seg_usuarios u ON ot.idTecnico = u.idUsuario LEFT JOIN Inv_cat_tipo_ot t ON ot.idTipoOT = t.idTipoOT WHERE (@idProyecto IS NULL OR ot.idProyecto = @idProyecto) AND (@idTecnico IS NULL OR ot.idTecnico = @idTecnico) AND (@estado IS NULL OR ot.estado = @estado) AND (@buscar IS NULL OR ot.direccion LIKE '%' + @buscar + '%' OR p.nombre LIKE '%' + @buscar + '%') ORDER BY ot.fechaCreacion DESC; END
GO